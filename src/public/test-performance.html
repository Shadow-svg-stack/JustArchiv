<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Performance - JustArchiv</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem; }
    .test { margin: 1rem 0; padding: 1rem; border-radius: 8px; border: 2px solid; }
    .success { border-color: #22c55e; background: #f0fdf4; }
    .error { border-color: #ef4444; background: #fef2f2; }
    .warning { border-color: #f59e0b; background: #fffbeb; }
    pre { background: #f9f9f9; padding: 1rem; border-radius: 4px; font-size: 12px; }
    button { background: #030213; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; }
    .loading { opacity: 0.6; }
  </style>
</head>
<body>
  <h1>üöÄ Test de Performance JustArchiv</h1>
  <p>Cette page teste que les optimisations de performance sont actives.</p>
  
  <button onclick="runTests()" id="runBtn">Lancer les tests</button>
  
  <div id="results"></div>

  <script>
    let tests = [];
    
    function addTest(name, status, message, details = '') {
      tests.push({ name, status, message, details });
      updateDisplay();
    }
    
    function updateDisplay() {
      const results = document.getElementById('results');
      results.innerHTML = tests.map(test => `
        <div class="test ${test.status}">
          <h3>${test.status === 'success' ? '‚úÖ' : test.status === 'error' ? '‚ùå' : '‚ö†Ô∏è'} ${test.name}</h3>
          <p><strong>${test.message}</strong></p>
          ${test.details ? `<pre>${test.details}</pre>` : ''}
        </div>
      `).join('');
    }
    
    async function runTests() {
      const btn = document.getElementById('runBtn');
      btn.disabled = true;
      btn.textContent = 'Tests en cours...';
      btn.className = 'loading';
      
      tests = [];
      updateDisplay();
      
      // Test 1: Sentry bloqu√©
      try {
        if (window.Sentry === undefined) {
          addTest('Blocage Sentry', 'success', 'Sentry correctement bloqu√©');
        } else {
          addTest('Blocage Sentry', 'error', 'Sentry d√©tect√© dans window');
        }
      } catch (e) {
        addTest('Blocage Sentry', 'success', 'Sentry bloqu√© avec exception');
      }
      
      // Test 2: Fetch intercept√©
      if (window.fetch.toString().includes('[native code]')) {
        addTest('Interception Fetch', 'warning', 'Fetch non intercept√©');
      } else {
        addTest('Interception Fetch', 'success', 'Fetch intercept√© pour blocage');
      }
      
      // Test 3: Test requ√™te Sentry (doit √™tre bloqu√©e)
      try {
        const start = performance.now();
        const response = await fetch('https://o22594.ingest.us.sentry.io/api/test');
        const duration = performance.now() - start;
        
        if (duration < 100 && response.ok) {
          const text = await response.text();
          addTest('Requ√™te Sentry', 'success', `Sentry bloqu√© en ${duration.toFixed(1)}ms`, `Response: ${text}`);
        } else {
          addTest('Requ√™te Sentry', 'error', `Sentry NON bloqu√©: ${duration.toFixed(1)}ms`);
        }
      } catch (e) {
        addTest('Requ√™te Sentry', 'success', 'Requ√™te Sentry bloqu√©e par exception');
      }
      
      // Test 4: Test requ√™te Figma (doit √™tre bloqu√©e)
      try {
        const start = performance.now();
        const response = await fetch('https://www.figma.com/webpack-artifacts/test');
        const duration = performance.now() - start;
        
        if (duration < 100) {
          addTest('Requ√™te Figma', 'success', `Figma bloqu√© en ${duration.toFixed(1)}ms`);
        } else {
          addTest('Requ√™te Figma', 'error', `Figma NON bloqu√©: ${duration.toFixed(1)}ms`);
        }
      } catch (e) {
        addTest('Requ√™te Figma', 'success', 'Requ√™te Figma bloqu√©e par exception');
      }
      
      // Test 5: Performance g√©n√©rale
      if (performance.getEntriesByType) {
        const navigation = performance.getEntriesByType('navigation')[0];
        if (navigation) {
          const loadTime = navigation.loadEventEnd - navigation.loadEventStart;
          const details = `
Load Time: ${loadTime.toFixed(1)}ms
DOM Ready: ${(navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart).toFixed(1)}ms
DNS: ${(navigation.domainLookupEnd - navigation.domainLookupStart).toFixed(1)}ms`;
          
          if (loadTime < 1000) {
            addTest('Performance', 'success', 'Temps de chargement excellent', details);
          } else {
            addTest('Performance', 'warning', 'Temps de chargement acceptable', details);
          }
        }
      }
      
      // Test 6: Ressources lentes
      if (performance.getEntriesByType) {
        const resources = performance.getEntriesByType('resource');
        const slowResources = resources.filter(r => r.duration > 1000);
        
        if (slowResources.length === 0) {
          addTest('Ressources Lentes', 'success', 'Aucune ressource lente d√©tect√©e');
        } else {
          const details = slowResources.map(r => `${r.name}: ${r.duration.toFixed(1)}ms`).join('\n');
          addTest('Ressources Lentes', 'warning', `${slowResources.length} ressource(s) lente(s)`, details);
        }
      }
      
      // R√©sum√©
      const successCount = tests.filter(t => t.status === 'success').length;
      const status = successCount === tests.length ? 'success' : successCount > tests.length/2 ? 'warning' : 'error';
      
      addTest('R√âSUM√â FINAL', status, 
        `${successCount}/${tests.length} tests r√©ussis`, 
        `JustArchiv est ${status === 'success' ? 'üéâ PARFAITEMENT' : status === 'warning' ? '‚úÖ CORRECTEMENT' : '‚ùå PARTIELLEMENT'} optimis√© !`
      );
      
      btn.disabled = false;
      btn.textContent = 'Relancer les tests';
      btn.className = '';
    }
    
    // Auto-run tests after 1 second
    setTimeout(runTests, 1000);
  </script>
</body>
</html>