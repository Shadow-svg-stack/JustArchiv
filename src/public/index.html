<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <!-- Title et description -->
  <title>JustArchiv - Gestion Documentaire Intelligente</title>
  <meta name="description" content="Application web complÃ¨te de gestion documentaire avec PWA, authentification sÃ©curisÃ©e et dashboard de maintenance. Organisez, recherchez et gÃ©rez vos documents en toute sÃ©curitÃ©." />
  <meta name="keywords" content="gestion documentaire, archivage, documents, PWA, sÃ©curisÃ©, entreprise" />
  <meta name="author" content="JustArchiv Team" />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="JustArchiv - Gestion Documentaire Intelligente" />
  <meta property="og:description" content="Application web complÃ¨te de gestion documentaire avec PWA, authentification sÃ©curisÃ©e et dashboard de maintenance." />
  <meta property="og:url" content="https://justarchiv.com" />
  <meta property="og:site_name" content="JustArchiv" />
  <meta property="og:image" content="/icons/og-image.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:locale" content="fr_FR" />
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="JustArchiv - Gestion Documentaire Intelligente" />
  <meta name="twitter:description" content="Application web complÃ¨te de gestion documentaire avec PWA, authentification sÃ©curisÃ©e et dashboard de maintenance." />
  <meta name="twitter:image" content="/icons/twitter-image.png" />
  <meta name="twitter:creator" content="@justarchiv" />
  
  <!-- Manifest PWA -->
  <link rel="manifest" href="/manifest.json" />
  
  <!-- Favicons et icÃ´nes -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#030213" />
  
  <!-- Theme et couleurs -->
  <meta name="theme-color" content="#030213" />
  <meta name="msapplication-TileColor" content="#030213" />
  <meta name="msapplication-config" content="/browserconfig.xml" />
  
  <!-- Apple Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="JustArchiv" />
  
  <!-- Microsoft Meta Tags -->
  <meta name="msapplication-starturl" content="/" />
  <meta name="msapplication-navbutton-color" content="#030213" />
  <meta name="msapplication-window" content="width=1024;height=768" />
  
  <!-- SÃ©curitÃ© -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://*.supabase.co;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com;
    img-src 'self' data: https: blob:;
    connect-src 'self' https://*.supabase.co https://images.unsplash.com wss://*.supabase.co;
    media-src 'self' data: blob:;
    object-src 'none';
    base-uri 'self';
    form-action 'self';
    frame-ancestors 'none';
    upgrade-insecure-requests
  " />
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-Frame-Options" content="DENY" />
  <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
  <meta http-equiv="Permissions-Policy" content="
    accelerometer=(),
    camera=(),
    geolocation=(),
    gyroscope=(),
    magnetometer=(),
    microphone=(),
    payment=(),
    usb=()
  " />
  
  <!-- Preconnect pour optimiser les performances -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://images.unsplash.com" />
  
  <!-- DNS Prefetch -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com" />
  <link rel="dns-prefetch" href="//fonts.gstatic.com" />
  <link rel="dns-prefetch" href="//images.unsplash.com" />
  
  <!-- Preload des ressources critiques -->
  <link rel="preload" href="/styles/globals.css" as="style" />
  <link rel="preload" href="/src/main.tsx" as="script" />
  
  <!-- Schema.org Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "JustArchiv",
    "description": "Application web complÃ¨te de gestion documentaire avec PWA, authentification sÃ©curisÃ©e et dashboard de maintenance",
    "url": "https://justarchiv.com",
    "author": {
      "@type": "Organization",
      "name": "JustArchiv Team"
    },
    "applicationCategory": "BusinessApplication",
    "operatingSystem": "Web Browser",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "EUR"
    },
    "screenshot": "/icons/screenshot.png",
    "softwareVersion": "1.0.0",
    "datePublished": "2024-01-01",
    "dateModified": "2024-01-01"
  }
  </script>
  
  <!-- Styles CSS -->
  <link rel="stylesheet" href="/styles/globals.css" />
  
  <!-- ULTIMATE PERFORMANCE BLOCKER - Niveau HTML -->
  <script>
    (function() {
      'use strict';
      console.log('[ðŸš€ ULTIMATE HTML BLOCKER] Maximum performance mode activated');
      
      // Patterns ultra-agressifs - PrÃ©compilÃ©s pour vitesse maximale
      const ULTIMATE_PATTERNS = [
        /sentry\.io/i,
        /o22594\.ingest\.us\.sentry\.io/i,
        /ingest\.sentry\.io/i,
        /js\.sentry-cdn\.com/i,
        /browser\.sentry-cdn\.com/i,
        /figma\.com.*webpack/i,
        /figma\.com\/webpack-artifacts/i,
        /\bapi\/56203\b/i,
        /sentry_key=/i,
        /\.figma\.site.*sentry/i
      ];
      
      // Cache ultra-rapide
      const htmlBlockCache = {};
      
      const ultimateBlock = function(url) {
        if (htmlBlockCache.hasOwnProperty(url)) return htmlBlockCache[url];
        const blocked = ULTIMATE_PATTERNS.some(function(p) { return p.test(url); });
        htmlBlockCache[url] = blocked;
        return blocked;
      };
      
      // SENTRY ULTIMATE NEUTRALIZATION
      const ultimateSentryMock = {
        init: function() { console.log('[ðŸš« HTML SENTRY] init blocked'); },
        captureException: function() { console.log('[ðŸš« HTML SENTRY] captureException blocked'); },
        captureMessage: function() { console.log('[ðŸš« HTML SENTRY] captureMessage blocked'); },
        configureScope: function() { console.log('[ðŸš« HTML SENTRY] configureScope blocked'); },
        addBreadcrumb: function() { console.log('[ðŸš« HTML SENTRY] addBreadcrumb blocked'); },
        setUser: function() { console.log('[ðŸš« HTML SENTRY] setUser blocked'); },
        setTag: function() { console.log('[ðŸš« HTML SENTRY] setTag blocked'); },
        setContext: function() { console.log('[ðŸš« HTML SENTRY] setContext blocked'); },
        withScope: function(cb) { console.log('[ðŸš« HTML SENTRY] withScope blocked'); try { if(cb) cb({}); } catch(e) {} },
        getCurrentHub: function() { return ultimateSentryMock; },
        getClient: function() { return null; },
        close: function() { return Promise.resolve(true); },
        startTransaction: function() { 
          console.log('[ðŸš« HTML SENTRY] startTransaction blocked');
          return { finish: function(){}, setStatus: function(){}, setTag: function(){} };
        }
      };
      
      // Forcer Sentry Ã  notre mock (non-configurable)
      try {
        Object.defineProperty(window, 'Sentry', {
          value: ultimateSentryMock,
          writable: false,
          configurable: false,
          enumerable: false
        });
      } catch(e) {
        window.Sentry = ultimateSentryMock;
      }
      
      // Variables globales Sentry
      try {
        window.__SENTRY__ = undefined;
        window.__SENTRY_DEBUG__ = false;
        window.SENTRY_RELEASE = undefined;
      } catch(e) {}
      
      // FETCH ULTIMATE INTERCEPTION
      if (window.fetch) {
        const origFetch = window.fetch;
        window.fetch = function(resource, options) {
          try {
            const url = typeof resource === 'string' ? resource : 
                       resource instanceof URL ? resource.href :
                       resource.url || resource.toString();
            
            if (ultimateBlock(url)) {
              console.log('[ðŸš« HTML FETCH] ULTIMATE BLOCK:', url);
              return Promise.reject(new Error('ULTIMATE_HTML_BLOCK'));
            }
            
            return origFetch.call(this, resource, options);
          } catch(e) {
            return origFetch.call(this, resource, options);
          }
        };
      }
      
      // XHR ULTIMATE INTERCEPTION
      const OrigXHR = window.XMLHttpRequest;
      window.XMLHttpRequest = function() {
        const xhr = new OrigXHR();
        const origOpen = xhr.open;
        
        xhr.open = function(method, url) {
          try {
            if (ultimateBlock(url.toString())) {
              console.log('[ðŸš« HTML XHR] ULTIMATE BLOCK:', url);
              setTimeout(function() {
                try {
                  if (xhr.onerror) xhr.onerror(new ErrorEvent('error'));
                } catch(e) {}
              }, 0);
              return;
            }
            return origOpen.apply(this, arguments);
          } catch(e) {
            return origOpen.apply(this, arguments);
          }
        };
        
        return xhr;
      };
      
      // WEBSOCKET ULTIMATE BLOCK
      const OrigWS = window.WebSocket;
      window.WebSocket = function(url) {
        if (ultimateBlock(url)) {
          console.log('[ðŸš« HTML WebSocket] ULTIMATE BLOCK:', url);
          throw new Error('ULTIMATE_HTML_WEBSOCKET_BLOCK');
        }
        return new OrigWS(url);
      };
      
      // IMAGE/SCRIPT ULTIMATE PREVENTION
      const origCreateElement = document.createElement;
      document.createElement = function(tagName) {
        const element = origCreateElement.call(this, tagName);
        
        if (tagName.toLowerCase() === 'script') {
          const origSrcSetter = Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype, 'src').set;
          Object.defineProperty(element, 'src', {
            set: function(value) {
              if (ultimateBlock(value)) {
                console.log('[ðŸš« HTML SCRIPT] Creation blocked:', value);
                return;
              }
              origSrcSetter.call(this, value);
            },
            get: function() {
              return this.getAttribute('src') || '';
            }
          });
        }
        
        return element;
      };
      
      // Surveillance continue
      let cleanupCount = 0;
      const ultimateMonitor = setInterval(function() {
        try {
          // VÃ©rifier Sentry
          if (window.Sentry && window.Sentry !== ultimateSentryMock) {
            console.log('[ðŸ”„ HTML MONITOR] Sentry reinjection detected - re-blocking');
            window.Sentry = ultimateSentryMock;
          }
          
          // Nettoyer le cache pÃ©riodiquement
          if (++cleanupCount % 10 === 0) {
            for (let key in htmlBlockCache) {
              if (htmlBlockCache.hasOwnProperty(key)) {
                delete htmlBlockCache[key];
              }
            }
          }
        } catch(e) {}
      }, 2000);
      
      console.log('[ðŸš€ ULTIMATE HTML BLOCKER] âœ… MAXIMUM PERFORMANCE MODE ACTIVE');
    })();
  </script>
  
  <!-- DÃ©tection des fonctionnalitÃ©s critiques -->
  <script>
    // VÃ©rifier le support des fonctionnalitÃ©s critiques
    if (!window.fetch || !window.Promise || !window.Map || !window.Set) {
      document.write('<script src="https://cdn.jsdelivr.net/npm/core-js-bundle@3/minified.js"><\/script>');
    }
    
    // DÃ©tecter les capacitÃ©s du navigateur
    window.APP_CAPABILITIES = {
      serviceWorker: 'serviceWorker' in navigator,
      webWorkers: typeof Worker !== 'undefined',
      indexedDB: 'indexedDB' in window,
      webGL: (function() {
        try {
          var canvas = document.createElement('canvas');
          return !!(window.WebGLRenderingContext && canvas.getContext('webgl'));
        } catch(e) {
          return false;
        }
      })(),
      touch: 'ontouchstart' in window,
      geolocation: 'geolocation' in navigator,
      localStorage: (function() {
        try {
          localStorage.setItem('test', 'test');
          localStorage.removeItem('test');
          return true;
        } catch(e) {
          return false;
        }
      })(),
      sessionStorage: (function() {
        try {
          sessionStorage.setItem('test', 'test');
          sessionStorage.removeItem('test');
          return true;
        } catch(e) {
          return false;
        }
      })()
    };
    
    // Performance timing
    window.APP_START_TIME = Date.now();
    
    // Error reporting global
    window.onerror = function(msg, url, lineNo, columnNo, error) {
      console.error('Global error:', { msg, url, lineNo, columnNo, error });
      
      // Envoyer l'erreur Ã  votre service de monitoring
      if (window.fetch && typeof window.fetch === 'function') {
        fetch('/api/errors', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            type: 'javascript',
            message: msg,
            url: url,
            line: lineNo,
            column: columnNo,
            error: error ? error.stack : null,
            userAgent: navigator.userAgent,
            timestamp: new Date().toISOString(),
            pageUrl: location.href
          })
        }).catch(function() {
          // Ignore fetch errors
        });
      }
      
      return false;
    };
    
    // Unhandled promise rejections
    window.addEventListener('unhandledrejection', function(event) {
      console.error('Unhandled promise rejection:', event.reason);
      
      if (window.fetch && typeof window.fetch === 'function') {
        fetch('/api/errors', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            type: 'promise',
            message: event.reason ? event.reason.toString() : 'Unhandled promise rejection',
            stack: event.reason && event.reason.stack ? event.reason.stack : null,
            userAgent: navigator.userAgent,
            timestamp: new Date().toISOString(),
            pageUrl: location.href
          })
        }).catch(function() {
          // Ignore fetch errors
        });
      }
    });
  </script>
</head>
<body>
  <noscript>
    <div style="
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #f3f4f6;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      font-family: system-ui, sans-serif;
      text-align: center;
      padding: 2rem;
    ">
      <div style="
        background: white;
        padding: 2rem;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        max-width: 400px;
      ">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 0 auto 1rem;">
          <path d="M12 2L2 7V10C2 16 6 20.5 12 22C18 20.5 22 16 22 10V7L12 2Z" stroke="#030213" stroke-width="2" fill="none"/>
        </svg>
        <h1 style="margin: 0 0 1rem; color: #030213; font-size: 1.5rem; font-weight: 600;">
          JustArchiv
        </h1>
        <p style="margin: 0 0 1rem; color: #6b7280; line-height: 1.5;">
          JavaScript est requis pour utiliser JustArchiv. 
          Veuillez activer JavaScript dans votre navigateur et recharger la page.
        </p>
        <button onclick="location.reload()" style="
          background: #030213;
          color: white;
          border: none;
          padding: 0.75rem 1.5rem;
          border-radius: 0.375rem;
          font-weight: 500;
          cursor: pointer;
          transition: background-color 0.2s;
        " onmouseover="this.style.backgroundColor='#374151'" onmouseout="this.style.backgroundColor='#030213'">
          Recharger la page
        </button>
      </div>
    </div>
  </noscript>
  
  <!-- Container principal de l'application React -->
  <div id="root" style="height: 100vh;"></div>
  
  <!-- Chargement des scripts -->
  <script type="module" src="/src/main.tsx"></script>
  
  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator && location.protocol === 'https:') {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js')
          .then(function(registration) {
            console.log('SW registered: ', registration);
            
            // VÃ©rifier les mises Ã  jour toutes les heures
            setInterval(function() {
              registration.update();
            }, 60 * 60 * 1000);
          })
          .catch(function(registrationError) {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }
  </script>
  
  <!-- Analytics et monitoring (Ã  configurer avec vos services) -->
  <!-- 
  <script>
    // Google Analytics, Mixpanel, etc.
  </script>
  -->
</body>
</html>